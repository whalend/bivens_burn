---
title: "Bivens Burn Data Analysis"
author: "W.W. Dillon"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: 
      collapsed: false
---

Target Journal:

PNAS, Proc. B, Nature Communications

Neobiota comments: serotiny of long-leaf, fire-effects at different times, fire size~intensity, total diff in number of living trees in the plots at the end (pre-burn/post-burn)

Relationship between height and survival - tree level analysis


```{r setup, message=FALSE, echo=F}

knitr::opts_chunk$set(echo = F, warning = F, message = F)
knitr::opts_chunk$set(fig.width = 7.5, fig.height = 7.5)

```


```{r load packages, message=FALSE}

library(plyr)
library(dplyr)
library(tidyr)
library(readxl)
library(readr)
library(ggplot2)
library(viridis)

```

```{r load data, message=FALSE}

temperatures <- read_csv("data/temperatureID_data_noNA.csv")
treatments <- read_excel("data/Bivens.treatments.xlsx")
flame_heights <- read_excel("data/FlameHts.xlsx")
fuel_data <- read_excel("data/BivensBurnData_fuel.xlsx")
tree_survival <- read_csv("data/LLP_Surv_2018_corrected.csv")

```

```{r global values}

figure_width <-  7.5
figure_height <- 7.5

# define color ####
# invasion_color <- scale_color_viridis(begin = .15, end = .9, option = "E", discrete = T)
# invasion_fill <- scale_fill_viridis(begin = .15, end = .9, option = "E", discrete = T)

invasion_color <- scale_color_manual(values = c("deepskyblue","red"))
invasion_fill <- scale_fill_manual(values = c("deepskyblue","red"))

# define theme ####
def_theme <- theme(legend.title = element_blank(),
            legend.text = element_text(size = 14),
            # legend.position = "none",
            axis.text = element_text(size = 18),
            axis.title = element_text(size = 18),
            plot.title = element_text(size = 20),
            strip.background = element_blank(),
            strip.text = element_text(size = 14),
            panel.grid = element_blank()
            )

dodge <- position_dodge(width=0.9)

```


```{r data munging}

treatments <- treatments %>% 
  mutate(water_trt = substr(Treatment, 1,1),
         veg_trt = substr(Treatment,2,2),
         water_trt = if_else(water_trt=="D", "drought", "ambient"),
         water_trt = factor(water_trt, levels = c("ambient","drought")),
         veg_trt = if_else(veg_trt=="C", "invaded", "reference"),
         veg_trt = factor(veg_trt, levels = c("reference","invaded"))
         )


# fuel load data ####
fuel_height <- fuel_data %>% 
  select(Plot, Location, FH1:FH3) %>% 
  gather(measure, fuel_height_cm, FH1, FH2, FH3) %>% 
  mutate(measure = substr(measure, 3,3)) %>% 
  group_by(Plot, Location) %>% 
  summarise(avg_fuel_ht_cm = mean(fuel_height_cm, na.rm = TRUE)) %>% 
  ungroup(.)

litter_depth <- fuel_data %>% 
  select(Plot, Location, LD1:LD3) %>% 
  gather(measure, litter_depth_cm, LD1, LD2, LD3) %>% 
  mutate(measure = substr(measure, 3,3)) %>% 
  group_by(Plot, Location) %>% 
  summarise(avg_litter_depth_cm = mean(litter_depth_cm, na.rm = TRUE)) %>% 
  ungroup(.)

fuel_structure <- left_join(
  fuel_height, 
  litter_depth, 
  by = c("Plot","Location")
)

fuel_structure <- left_join(
  fuel_structure,
  treatments %>% select(-Treatment),
  by = "Plot"
)

fuel_mass <- fuel_data %>% 
  select(Plot, Location, freshwt, drywt) %>% 
  mutate(fuel_moisture = 100*(freshwt-drywt)/freshwt)

fuel_mass <- left_join(
  fuel_mass,
  treatments %>% select(-Treatment),
  by = "Plot"
)

fuel_measures <- left_join(
  fuel_mass,
  fuel_structure
)


# flame height data ####

flame_hts <- flame_heights %>% 
  # mutate(avg_flame_ht = rowMeans(cbind(Flame_ht1,Flame_ht2), na.rm = T)) %>% 
  gather(flameID, flameht_cm, Flame_ht1, Flame_ht2)

flame_hts <- left_join(
  flame_hts, treatments, by = "Plot"
)

flame_ht_location <- flame_hts %>% 
  group_by(Plot, Location, water_trt, veg_trt) %>% 
  summarise(avg_flameht_cm = mean(flameht_cm))

# skimr::skim(flame_hts %>% 
#               group_by(water_trt, veg_trt) %>% 
#               select(flameht_cm))


flame_heights_trt <- flame_hts %>%
  group_by(veg_trt, water_trt) %>% 
  summarise(avg_flameht_cm = mean(flameht_cm, na.rm = T),
            nobs = length(flameht_cm),
            se_flameht = sd(flameht_cm)/sqrt(nobs))

 # mean(c(72,82,233,272,246,195))
 # sd(c(72,82,233,272,246,195))

# dodge_width <- 0.8

fuel_flame_data <- left_join(
  fuel_measures,
  flame_ht_location)

# summarize temperature data ####

temperatures <- temperatures %>% 
  rename(Plot = plot_num, 
         Box_ID = box_number, 
         Location = location) %>% 
  mutate(Box_ID = as.numeric(substr(Box_ID, start = 4, stop = nchar(Box_ID))),
         probe_ht = factor(probe_ht, levels = c("50cm","25cm","0cm")))


temps_abv_100_data <- temperatures %>% 
  group_by(Plot, Location, probe_ht) %>% 
  filter(probe_tempC >= 100) %>% 
  summarise(seconds_abv_100 = length(probe_tempC),
            heat_flux_abv_100 = sum(probe_tempC)
            ) %>% 
  ungroup(.)

temps_abv_100_data <- left_join(
  temps_abv_100_data,
  fuel_flame_data
)


# temps_abv_100_data %>% 
#   group_by(water_trt, veg_trt, probe_ht) %>% 
#   select(seconds_abv_100) %>% 
#   skimr::skim(.)

max_temperatures <- temperatures %>% 
  group_by(Plot, Location, probe_ht) %>% 
  arrange(desc(probe_tempC)) %>% 
  summarise(max_temp = max(probe_tempC),
            max_temp_avg5 = mean(probe_tempC[1:5])) %>% 
  ungroup(.)

max_temperatures <- left_join(
  max_temperatures,
  fuel_flame_data
)

# max_temperatures %>% 
#   group_by(water_trt, veg_trt, probe_ht) %>% 
#   select(max_temp) %>% 
#   skimr::skim(.)

temperatures <- left_join(
  temperatures,
  select(treatments, -Treatment),
  by = "Plot"
)

# tree damage/survival ####

# tree_survival <- tree_survival %>% 
#   filter(!is.na(pct_brown)) %>% 
#   select(-Ind, -Row, -Column)
# summary(tree_survival)
# 
# tree_survival %>% filter(is.na(diam2_mm))
# unique(tree_survival$dbh_cm)
# summary(tree_survival)

tree_dmg <- tree_survival %>% 
  filter(!is.na(total_limbs)) %>% 
  select(Plot, Ind., pct_brown, dead_limbs, total_limbs, char_ht_cm, ht2_cm) %>% 
  mutate(tree_id = seq_len(nrow(.)),
         pct_dead_limbs = 100*dead_limbs/total_limbs)
## Excluded dbh because it is missing for 29 of the trees

tree_dmg <- left_join(
  tree_dmg,
  select(treatments, -Treatment)
)

tree_dmg <- tree_dmg %>% 
  mutate(alive = if_else(pct_dead_limbs==100, 0, 1),
         dead = if_else(pct_dead_limbs==100, 1, 0),
         survival = if_else(pct_dead_limbs==100, 0, 1))

# tree_dmg %>% 
#   group_by(veg_trt, water_trt) %>% 
#   summarise(plot_totals = n_distinct(Plot))

# summary(tree_dmg)



# aggregate data ####

agg_data <- left_join(
  max_temperatures,
  temps_abv_100_data
  ) 

agg_data <- left_join(agg_data, fuel_flame_data)

# summary(agg_data)

agg_data$seconds_abv_100[is.na(agg_data$seconds_abv_100)] <- 0
agg_data$heat_flux_abv_100[is.na(agg_data$heat_flux_abv_100)] <- 0

# summarize to plot-level

agg_max_temperatures <- max_temperatures %>% 
  group_by(Plot, probe_ht, water_trt, veg_trt) %>% 
  summarise(avg_max_temp = mean(max_temp_avg5)) %>% 
  ungroup(.)

agg_temps_abv_100_data <- temps_abv_100_data %>% 
  mutate(seconds_abv_100 = ifelse(is.na(seconds_abv_100), 0, seconds_abv_100),
         heat_flux_abv_100 = ifelse(is.na(heat_flux_abv_100), 0, heat_flux_abv_100)) %>% 
  group_by(Plot, probe_ht, water_trt, veg_trt) %>% 
  summarise(avg_s_abv_100 = mean(seconds_abv_100),
            avg_heat_flux100 = mean(heat_flux_abv_100)) %>% 
  ungroup(.)

agg_fuel_flame_data <- fuel_flame_data %>% 
  group_by(Plot, water_trt,veg_trt) %>% 
  summarise(avg_drywt = mean(drywt),
            avg_fuel_moisture = mean(fuel_moisture),
            avg_fuel_ht_cm = mean(avg_fuel_ht_cm),
            avg_litter_depth_cm = mean(avg_litter_depth_cm),
            avg_flameht_cm = mean(avg_flameht_cm)) %>% 
  ungroup(.)


agg_plot_data <- agg_data %>% 
  group_by(Plot, veg_trt, water_trt, probe_ht) %>% 
  summarise(avg_max_temp = mean(max_temp_avg5),
            avg_s_abv100 = mean(seconds_abv_100),
            avg_heat_flux100 = mean(heat_flux_abv_100),
            avg_dry_wt = mean(drywt),
            avg_fuel_moisture = mean(fuel_moisture),
            avg_fuel_ht_cm = mean(avg_fuel_ht_cm),
            avg_litter_depth_cm = mean(avg_litter_depth_cm),
            avg_flameht_cm = mean(avg_flameht_cm)
            )

tree_agg_plot_data <- left_join(
  agg_plot_data,
  tree_dmg
  ) %>% 
  na.omit(.)
# summary(tree_agg_plot_data)
# n_distinct(filter(tree_agg_plot_data, probe_ht=="50cm")$tree_id)

tree_dmg %>% 
  group_by(Plot, water_trt, veg_trt) %>% 
  summarise(trees_alive = sum(alive, na.rm = TRUE),
            trees_dead = sum(dead, na.rm = TRUE),
            avg_tree_ht_cm = mean(ht2_cm, na.rm = TRUE))

agg_plot_data <- left_join(
  agg_plot_data,
  tree_dmg %>% 
  group_by(Plot, water_trt, veg_trt) %>% 
  summarise(trees_alive = sum(alive, na.rm = TRUE),
            trees_dead = sum(dead, na.rm = TRUE),
            avg_tree_ht_cm = mean(ht2_cm, na.rm = TRUE))
)


```

```{r export data for science fieldtrip, eval=F}

fuel_measures %>%
  rename(dry_weight_g = avg_drywt,
         veg_moisture_pct = avg_moisture,
         veg_ht_cm = avg_fuel_ht_cm) %>% 
  write_csv(., "~/CodingEnvSci_UF_FieldTrip/coding_curriculum/data/bivens_veg_data_example.csv")

```

# Fuel condition summary

## Fuel load & moisture figures

```{r skim fuel load data, eval=FALSE}

# fuel_ht
# fuel_mass
fuel_mass %>% 
  group_by(water_trt, veg_trt) %>% 
  select(drywt, fuel_moisture) %>%
  skimr::skim(.)

```


```{r fuel load barchart, eval=FALSE}

(fuel_load_fig <- ggplot(
  fuel_mass %>% 
    group_by(water_trt, veg_trt) %>% 
    summarise(avg_drywt = mean(drywt*16),
              nobs = length(drywt),
              se_drywt = sd(drywt*16)/sqrt(nobs)), 
  aes(water_trt, avg_drywt, fill = veg_trt)) +
  invasion_color + 
  invasion_fill +
  geom_col(position = dodge) +
  geom_errorbar(aes(ymax = avg_drywt + se_drywt, ymin = avg_drywt - se_drywt), position = dodge, width = 0) +
  # geom_point(aes(color = veg_trt)) +
  # stat_summary(aes(color = veg_trt),fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .2)) +
  # facet_grid(probe_ht~.) +
  theme_bw() +
  def_theme +
  xlab("") +
  ylab(expression(paste("Fuel load (g ", {m}^-2, ")"), sep = "")) +
  theme(legend.position = "top")
)
ggsave("figures/fuel_load_bar.png", height = 4, width = 5, dpi = 300)

```

```{r fuel load mean se, eval=FALSE}

ggplot(fuel_mass, aes(water_trt, drywt*16, fill = veg_trt)) +
  invasion_color + 
  invasion_fill +
  # geom_point(aes(color = veg_trt), position = "jitter", alpha = .3) +
  # geom_col(position = dodge) +
  # geom_errorbar(aes(ymax = avg_drywt + se_drywt, ymin = avg_drywt - se_drywt), position = dodge, width = 0) +
  # geom_point(aes(color = veg_trt)) +
  stat_summary(aes(color = veg_trt),fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .2), size = 1) +
  # scale_y_continuous(limits = c(0,190)) +
  theme_bw() +
  def_theme +
  xlab("") +
  ylab(expression(paste("Fuel load (g ", {m}^-2, ")"), sep = "")) +
  theme(legend.position = "top")

```

```{r fuel load boxplot}

## Location-level aggregation n=120, 30 per treatment
ggplot(fuel_mass, aes(water_trt, .001*drywt*16)) +
  # geom_violin(draw_quantiles = c(.25, .5, .75)) +
  geom_boxplot(aes(color = veg_trt), notch = F, outlier.color = "white") +
  geom_point(aes(color = veg_trt), position = position_jitterdodge(dodge.width = .8, jitter.width = .2)) +
  invasion_fill +
  invasion_color+
  theme_bw() +
  def_theme +
  xlab("") +
  ylab(expression(paste("Fuel load (kg ", {m}^-2, ")"), sep = "")) +
  theme(legend.position = "top")

## Plot-level aggregation n=40, 10 per treatment
ggplot(filter(agg_plot_data, probe_ht=="0cm"), aes(water_trt, .001*avg_dry_wt*16)) +
  geom_boxplot(aes(color = veg_trt), notch = F, outlier.color = "white") +
  geom_point(aes(color = veg_trt), position = position_jitterdodge(dodge.width = .8, jitter.width = .2)) +
  invasion_fill +
  invasion_color+
  theme_bw() +
  def_theme +
  xlab("") +
  ylab(expression(paste("Fuel load (kg ", {m}^-2, ")"), sep = "")) +
  theme(legend.position = "top")


knitr::kable(fuel_mass %>% 
    group_by(water_trt, veg_trt) %>% 
    summarise(avg_drywt = mean(.001*drywt*16),
              nobs = length(drywt),
              se_drywt = sd(.001*drywt*16)/sqrt(nobs)),
    digits = 2, caption = "Fuel load based on sample dry weight")

```

```{r fuel moisture barchart, eval=FALSE}

(fuel_moisture_fig <- ggplot(
  fuel_mass %>% 
    group_by(water_trt, veg_trt) %>% 
    summarise(avg_moisture = mean(fuel_moisture),
              nobs = length(fuel_moisture),
              se_moisture = sd(fuel_moisture)/sqrt(nobs)),
  aes(water_trt, avg_moisture, fill = veg_trt)) +
  invasion_color + 
  invasion_fill +
  geom_col(position = dodge) +
  geom_errorbar(aes(ymax = avg_moisture + se_moisture, ymin = avg_moisture - se_moisture), position = dodge, width = 0) +
  theme_bw() +
  def_theme +
  xlab("") +
  ylab("Fuel moisture (%)") +
  theme(legend.position = "top")
)
ggsave("figures/fuel_moisture_bar.png", height = 4, width = 5, dpi = 300)

```

```{r fuel moisture boxplot}

ggplot(fuel_mass, aes(water_trt, fuel_moisture)) +
  # geom_violin(draw_quantiles = c()) +
  geom_boxplot(aes(color = veg_trt), notch = F, outlier.color = "white") +
  geom_point(aes(color = veg_trt), position = position_jitterdodge(dodge.width = .8, jitter.width = .2)) +
  # stat_summary(aes(color = veg_trt),fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .2), size = 1) +
  invasion_fill +
  invasion_color +
  theme_bw() +
  def_theme +
  xlab("") +
  ylab("Fuel moisture (%)") +
  theme(legend.position = "top")

ggplot(filter(agg_plot_data, probe_ht=="0cm"), aes(water_trt, avg_fuel_moisture)) +
  geom_boxplot(aes(color = veg_trt), notch = F, outlier.color = "white") +
  geom_point(aes(color = veg_trt), position = position_jitterdodge(dodge.width = .8, jitter.width = .2)) +
  # stat_summary(aes(color = veg_trt),fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .2), size = 1) +
  invasion_fill +
  invasion_color +
  theme_bw() +
  def_theme +
  xlab("") +
  ylab("Fuel moisture (%)") +
  theme(legend.position = "top")

knitr::kable(fuel_mass %>% 
    group_by(water_trt, veg_trt) %>% 
    summarise(avg_moisture = mean(fuel_moisture),
              nobs = length(fuel_moisture),
              se_moisture = sd(fuel_moisture)/sqrt(nobs)), 
    digits = 2, caption = "Fuel moisture")

```

## Char height

```{r char height fig}
# tree_dmg %>% 
#          group_by(veg_trt, water_trt) %>% 
#          summarise(avg_ht = mean(char_ht_cm),
#                    nobs = length(char_ht_cm),
#                    se = sd(ht2_cm, na.rm = T)/sqrt(nobs))
ggplot(tree_dmg, 
       aes(water_trt, char_ht_cm)) +
  # geom_col(position = dodge) + 
  # geom_errorbar(aes(ymax = avg_ht+se, ymin = avg_ht-se), position = dodge, width = 0) + 
  geom_boxplot(aes(color = veg_trt), alpha = 0) +
  geom_point(aes(color = veg_trt), position = position_jitterdodge(dodge.width = .8)) +
  invasion_fill +
  invasion_color +
  theme_bw() +
  def_theme +
  xlab("") +
  ylab("Char height (cm)") +
  theme(legend.position = "top")

knitr::kable(tree_dmg %>% 
         group_by(veg_trt, water_trt) %>% 
         summarise(avg_char_ht = mean(char_ht_cm),
                   avg_tree_ht = mean(ht2_cm),
                   nobs = length(char_ht_cm)),
         digits = 2, caption = "Average char & tree heights")

```


## Tree height

```{r tree height fig}
# tree_dmg %>%
         # group_by(veg_trt, water_trt) %>% 
         # summarise(avg_ht = mean(ht2_cm),
         #           nobs = length(ht2_cm),
         #           se = sd(ht2_cm, na.rm = T)/sqrt(nobs)) %>% 
ggplot(tree_dmg, 
       aes(water_trt, ht2_cm)) +
  # geom_col(position = dodge) + 
  # geom_errorbar(aes(ymax = avg_ht+se, ymin = avg_ht-se), position = dodge, width = 0) + 
  geom_boxplot(aes(color = veg_trt)) +
  geom_point(aes(color = veg_trt), position = position_jitterdodge(dodge.width = .75), alpha = .5) +
  # stat_summary(fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .2), size = 1) +
  invasion_fill +
  invasion_color +
  theme_bw() +
  def_theme +
  xlab("") +
  ylab("Tree height (cm)") +
  theme(legend.position = "top")

knitr::kable(tree_dmg %>% 
         group_by(veg_trt, water_trt) %>% 
         summarise(avg_ht = mean(ht2_cm),
                   nobs = length(ht2_cm),
                   se = sd(ht2_cm, na.rm = T)/sqrt(nobs)),
         digits = 2, caption = "Average tree height")

```

```{r tree height lm}

treeht_lm1 <- lm(ht2_cm ~ veg_trt*water_trt, data = tree_dmg)

summary(treeht_lm1)
car::Anova(treeht_lm1, type = "II")

sjPlot::plot_model(treeht_lm1, type = "diag")

sjPlot::plot_model(
  treeht_lm1, 
  show.values = T, show.data = T,
  vline.color = "gray90",
  value.size = 5, dot.size = 3.5, line.size = 1, value.offset = .2,
  colors = "viridis",
  title = "Tree height (cm)", 
  # axis.labels = c("invaded","drought*invaded","drought")
  ) +
  theme_bw()+
  theme(axis.text = element_text(size = 12),
        panel.grid = element_blank())

```

The model below with plot as a random effect gives very similar estimates for the treatment effects as the model with no random effect above.

```{r tree height lmer}

treeht_lmer1 <- lmerTest::lmer(ht2_cm ~ veg_trt*water_trt + (1|Plot), data = tree_dmg)
summary(treeht_lmer1)

car::Anova(treeht_lmer1, type = "2")

sjPlot::plot_model(treeht_lmer1, type = "est", show.values = T, vline.color = "gray90", colors = "viridis") +
  theme_bw()

```


## Flame height figures

```{r flame height barchart, eval=F}

ggplot(flame_hts_trt, aes(water_trt, avg_flameht_cm, fill = veg_trt)) +
  # geom_boxplot(aes(fill = veg_trt), notch = F, alpha = .5) +
  # geom_violin(aes(fill = veg_trt), alpha = .5) +
  # geom_point(aes(color = veg_trt), position = "jitter") +
  invasion_color + 
  invasion_fill +
  geom_col(position = dodge) +
  geom_errorbar(aes(ymax = avg_flameht_cm + se_flameht, ymin = avg_flameht_cm - se_flameht), position = dodge, width = 0) +
  # geom_point(aes(color = veg_trt)) +
  # stat_summary(aes(color = veg_trt),fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .2)) +
  # facet_grid(probe_ht~.) +
  theme_bw() +
  def_theme +
  theme(legend.position = "top") +
  xlab("") +
  ylab("Flame height (cm)")
# ggsave("figures/flame_hts_bar.png", height = 4, width = 5, dpi = 300)

```

```{r flame height boxplot}

ggplot(flame_hts, aes(water_trt, flameht_cm)) +
  geom_boxplot(aes(color = veg_trt), outlier.colour = "white", ) +
  geom_point(aes(color = veg_trt), position = position_jitterdodge(dodge.width = .8, jitter.width = .4)) +
  invasion_color + 
  invasion_fill +
  # stat_summary(aes(color = veg_trt),fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .2), size = .8) +
  # facet_grid(probe_ht~.) +
  theme_bw() +
  def_theme +
  theme(legend.position = "top") +
  xlab("") +
  ylab("Flame height (cm)")

```

```{r flame heights table}

knitr::kable(flame_heights_trt, digits = 2)
 
```

Two observations of flame height at three locations in each plot, with ten plots in each treatment group.

# Temperature Data

Two temperature profile examples with a horizontal line indicating 100ºC on each graph.

```{r temperature profile example}

ggplot(filter(temperatures, Plot==8, Box_ID==9),
       aes(time, probe_tempC)) +
  geom_path(aes(color = probe_ht)) +
  geom_hline(yintercept = 100) +
  theme_classic() +
  ggtitle("Cogongrass-invaded with drought treatment")
  NULL
  
ggplot(filter(temperatures, Plot==16, Box_ID==9),
       aes(time, probe_tempC)) +
  geom_path(aes(color = probe_ht)) +
  geom_hline(yintercept = 100) +
  theme_classic() +
  ggtitle("Reference vegetation with drought treatment")
  NULL

```


## Time >100 ºC figures

```{r time above 100 barchart, eval=FALSE}

ggplot(temps_abv_100_data %>% 
         group_by(probe_ht, veg_trt, water_trt) %>% 
         summarise(avg_s_abv100 = mean(seconds_abv_100),
                   nobs = length(seconds_abv_100),
                   se_s_abv100 = sd(seconds_abv_100/sqrt(nobs))), 
       aes(water_trt, avg_s_abv100, fill = veg_trt)) +
  geom_col(position = dodge) +
  geom_errorbar(aes(ymax = avg_s_abv100 + se_s_abv100, ymin = avg_s_abv100 - se_s_abv100), position = dodge, width = 0) +
  invasion_fill +
  facet_grid(.~probe_ht) +
  theme_bw() + 
  def_theme +
  ylab("Seconds >100 ºC") +
  xlab("") +
  theme(legend.position = "top")
# ggsave("figures/seconds_abv100_bar.png", height = 4, width = 9, dpi = 300)

```


```{r temps above 100 figs}

ggplot(filter(temps_abv_100_data, seconds_abv_100<1200), aes((drywt*16)/1000, seconds_abv_100)) +
  geom_point(aes(color = veg_trt), alpha = .5) +
  # stat_summary(aes(color = veg_trt), fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .2), size = 1) +
  # geom_boxplot(aes(color = veg_trt)) +
  # scale_y_continuous(breaks = c(0, 100, 150, 200), labels = c("0","100","150","200")) +
  geom_smooth(aes(color = veg_trt, fill = veg_trt), alpha = .2, method = "lm") +
  facet_grid(probe_ht~water_trt) +
  invasion_color +
  invasion_fill +
  theme_bw() +
  def_theme +
  ylab("Seconds >100 ºC") +
  xlab(expression(paste("Fuel load (kg ", {m}^-2, ")"), sep = "")) +
  theme(legend.position = "top") +
  NULL
# ggsave("figures/seconds_abv100.png", height = 4, width = 9, dpi = 300)

## Temperature metrics aggregated to n=10 plots for each treatment combo
ggplot(agg_plot_data, aes((avg_dry_wt*16)/1000, avg_s_abv100)) +
  geom_point(aes(color = veg_trt), alpha = .5) +
  invasion_color +
  invasion_fill +
  geom_smooth(aes(color = veg_trt, fill = veg_trt), alpha = .2, method = "lm") +
  facet_grid(probe_ht~water_trt) +
  theme_bw() +
  def_theme +
  theme(legend.position = c(.396,.275), 
        legend.direction = "vertical",
        legend.background = element_blank()) +
  xlab(expression(paste("Fuel load (kg ", {m}^-2, ")"), sep = "")) +
  ylab("Temperature residence time >100ºC")


ggplot(agg_plot_data, aes((avg_dry_wt*16)/1000, avg_heat_flux100)) +
  geom_point(aes(color = veg_trt), alpha = .5) +
  invasion_color +
  invasion_fill +
  geom_smooth(aes(color = veg_trt, fill = veg_trt), alpha = .2, method = "lm") +
  facet_grid(probe_ht~water_trt) +
  theme_bw() +
  def_theme +
  theme(legend.position = c(.11,.95), 
        legend.direction = "vertical",
        legend.background = element_blank()) +
  xlab(expression(paste("Fuel load (kg ", {m}^-2, ")"), sep = "")) +
  ylab("Heat flux >100 ºC (s * temperature)") +
  NULL


# ggplot(temps_abv_100_data, aes(avg_drywt, seconds_abv_100)) +
#   geom_point(aes(color = veg_trt)) +
#   geom_smooth(aes(color = veg_trt), se = F) +
#   facet_grid(.~probe_ht, scales = "free_y") +
#   theme_bw() +
#   def_theme

```

```{r temps abv 100 table}

knitr::kable(temps_abv_100_data %>% 
         group_by(probe_ht, veg_trt, water_trt) %>% 
         summarise(avg_s_abv100 = mean(seconds_abv_100),
                   nobs = length(seconds_abv_100),
                   se_s_abv100 = sd(seconds_abv_100/sqrt(nobs))),
         digits = 2, caption = "Seconds above 100 ºC by treatment and probe height")

```

## Max temp figures

```{r max temp barchart, eval=FALSE}

ggplot(max_temperatures %>% 
         group_by(probe_ht, water_trt, veg_trt) %>% 
         summarise(avg_max_temp = mean(max_temp),
                   nobs = length(max_temp),
                   se_max_temp = sd(max_temp)/sqrt(nobs)), 
       aes(water_trt, avg_max_temp, fill = veg_trt)) +
  
  # stat_summary(aes(color = veg_trt), 
               # fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .2)) +
  geom_col(position = dodge) +
  geom_errorbar(aes(ymax = avg_max_temp + se_max_temp, ymin = avg_max_temp - se_max_temp), position = dodge, width = 0) +
  invasion_fill +
  facet_grid(.~probe_ht) +
  theme_bw() + 
  def_theme +
  ylab("Maximum temperature (ºC)") +
  xlab("") +
  theme(legend.position = "top",
        legend.direction = "vertical") +
  NULL
# ggsave("figures/max_temp_bars.png", height = 4, width = 9, dpi = 300)

```

```{r max temp mean_se, eval=FALSE}

ggplot(max_temperatures, aes(water_trt, max_temp)) +
  stat_summary(aes(color = veg_trt), fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .2), size = 1) +
  invasion_color +
  facet_grid(.~probe_ht) +
  theme_bw() + 
  def_theme +
  ylab("Maximum temperature (ºC)") +
  xlab("") +
  theme(legend.position = "top")
# ggsave("figures/max_temp.png", height = 4, width = 9, dpi = 300)

```

The first figure is the temperature and fuel load aggregated (averaged) for each plot, so n=10 for each treatment combination. 
```{r max temp regression figs}

## Aggregated to averages for n=10 plots for each treatment combination 
ggplot(agg_plot_data, aes((avg_dry_wt*16)/1000, avg_max_temp)) +
  geom_point(aes(color = veg_trt, shape = water_trt), alpha = 1) +
  scale_shape_discrete(solid = FALSE) +
  invasion_color +
  invasion_fill +
  geom_smooth(aes(color = veg_trt, fill = veg_trt), alpha = .2, method = "lm", show.legend = FALSE) +
  # stat_summary(aes(color = veg_trt), 
  #              fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .2)) +
  # stat_summary(aes(y = max_temp_avg5, color = veg_trt), 
  #              fun.data = "mean_se", geom = "pointrange", shape = 22, 
  #              position = position_dodge(width = .4)) +
  facet_grid(probe_ht~.) +
  theme_bw() +
  def_theme +
  theme(legend.position = c(.1,.88), 
        legend.direction = "vertical",
        legend.background = element_blank()) +
  xlab(expression(paste("Fuel load (kg ", {m}^-2, ")"), sep = "")) +
  ylab("Maximum temperature (ºC)")
# ggsave("figures/max_temp_scatter.png", height = 4, width = 9, dpi = 300)

## Not aggregated, so n=36 (max) for each treatment combination
ggplot(max_temperatures, aes((drywt*16)/1000, max_temp_avg5)) +
  geom_point(aes(color = veg_trt), alpha = .5) +
  invasion_color +
  invasion_fill +
  geom_smooth(aes(color = veg_trt, fill = veg_trt), alpha = .2, method = "lm") +
  facet_grid(probe_ht~water_trt) +
  theme_bw() +
  def_theme +
  theme(legend.position = c(.396,.275), 
        legend.direction = "vertical",
        legend.background = element_blank()) +
  xlab(expression(paste("Fuel load (kg ", {m}^-2, ")"), sep = "")) +
  ylab("Maximum temperature (ºC)")

```

```{r max temp summary tables}

knitr::kable(max_temperatures %>% 
         group_by(probe_ht, water_trt, veg_trt) %>% 
         summarise(avg_max_temp = mean(max_temp),
                   nobs = length(max_temp),
                   se_max_temp = sd(max_temp)/sqrt(nobs)), 
         digits = 2, caption = "Maximum temperature by treatment and probe height")

knitr::kable(max_temperatures %>% 
  group_by(probe_ht, veg_trt) %>% 
  summarise(avg_max_temp = mean(max_temp),
            nobs = length(max_temp),
            se_max_temp = sd(max_temp)/sqrt(nobs),
            maximum_temp = max(max_temp)),
  digits = 2, caption = "Maximum temperature by invasion status and probe height")

```

## Max temp regressions
```{r max temp 50cm regressions}

max_temps50_data <- max_temperatures %>% 
  filter(probe_ht=="50cm") %>% 
  mutate(veg_trt = as.factor(veg_trt),
         water_trt = as.factor(water_trt))
summary(max_temps50_data)

max_temp50_lme1 <- lmerTest::lmer(max_temp ~ drywt*veg_trt + drywt*water_trt + fuel_moisture + veg_trt*water_trt + (1|Plot), data = max_temps50_data, na.action = "na.fail")
summary(max_temp50_lme1)
MuMIn::r.squaredGLMM(max_temp50_lme1)
# dmod <- MuMIn::dredge(max_temp50_lme1)
# car::Anova(max_temp50_lme1, type = "II", test = "F")

max_temp50_lme2 <- lmerTest::lmer(max_temp ~ drywt + veg_trt + fuel_moisture + water_trt + (1|Plot), data = max_temps50_data)
summary(max_temp50_lme2)
anova(max_temp50_lme1,max_temp50_lme2)
car::Anova(max_temp50_lme2)

max_temp50_lme3 <- lmerTest::lmer(max_temp ~ drywt + veg_trt + water_trt + avg_fuel_ht_cm + (1|Plot), data = max_temps50_data)
summary(max_temp50_lme3)
car::Anova(max_temp50_lme3)

max_temp50_lme4a <- lmerTest::lmer(max_temp ~ drywt*veg_trt + avg_fuel_ht_cm + (1|Plot), data = max_temps50_data)
summary(max_temp50_lme4a)
car::Anova(max_temp50_lme4a)

max_temp50_lme4 <- lme4::lmer(max_temp ~ drywt + veg_trt + (1|Plot), data = max_temps50_data)
summary(max_temp50_lme4)
car::Anova(max_temp50_lme4, type = "II")

sjPlot::plot_model(
  max_temp50_lme4, type = "est", 
  show.values = T, vline.color = "gray90", colors = "viridis") +
  theme_bw()



# sjPlot::plot_model(max_temp50_lme4, type = "pred", terms = c("avg_drywt","veg_trt"), show.data = T)

# min(max_temps50_data$avg_drywt)*1.14 + 190
# median(max_temps50_data$avg_drywt)*1.14 + 190
# max(max_temps50_data$avg_drywt)*1.14 + 190
# min(max_temps50_data$avg_drywt)*1.14 + 190 + 328.26
# median(max_temps50_data$avg_drywt)*1.14 + 190 + 328.26
# max(max_temps50_data$avg_drywt)*1.14 + 190 + 328.26

sjPlot::plot_model(
  max_temp50_lme4, type = "std2", show.values = T, 
  vline.color = "black", colors = "viridis",
  title = "Standardized coefficients for max temp (divided by 2*sd)") +
  theme_bw()
MuMIn::r.squaredGLMM(max_temp50_lme4)

lm1 <- lm(max_temp ~ drywt + veg_trt, data = max_temps50_data)
summary(lm1)

max_temps50_data_plot <- max_temps50_data %>% 
  group_by(Plot, water_trt, veg_trt) %>% 
  summarise(avg_max_temp = mean(max_temp),
            avg_drywt = mean(drywt),
            avg_moisture = mean(fuel_moisture),
            avg_fuel_ht_cm = mean(avg_fuel_ht_cm)) %>% 
  ungroup(.)

max_temps50_lm <- lm(avg_max_temp ~ avg_drywt + veg_trt, data = max_temps50_data_plot)
# plot(max_temps50_lm)
summary(max_temps50_lm)

ggplot(max_temps50_data_plot, aes(.001*avg_drywt*16, avg_max_temp)) +
  geom_point(aes(color = veg_trt, shape = water_trt)) +
  geom_smooth(aes(fill = veg_trt, color = veg_trt), method = "lm", show.legend = FALSE) +
  scale_shape_discrete(solid = FALSE) +
  invasion_color +
  invasion_fill +
  theme_classic() +
  xlab(expression(paste("Fuel load (kg ", {m}^-2, ")"), sep = "")) +
  ylab("Maximum temperature (ºC)") +
  theme(legend.title = element_blank()) +
  NULL
  
```

```{r max temp 25cm regressions}

max_temps25_data <- max_temperatures %>% 
  filter(probe_ht=="25cm")

max_temp25_lme4 <- lme4::lmer(max_temp ~ drywt*veg_trt + (1|Plot), data = max_temps25_data)
summary(max_temp25_lme4)
car::Anova(max_temp25_lme4, type = "II")
MuMIn::r.squaredGLMM(max_temp25_lme4)

sjPlot::plot_model(
  max_temp25_lme4, type = "est", 
  show.values = T, vline.color = "gray90", colors = "viridis") +
  theme_bw()


```

```{r max temp 0cm regressions}

max_temps0_data <- max_temperatures %>% 
  filter(probe_ht=="0cm")

max_temp0_lme4 <- lme4::lmer(max_temp ~ drywt + veg_trt + (1|Plot), data = max_temps0_data)
summary(max_temp0_lme4)
car::Anova(max_temp0_lme4, type = "II")
MuMIn::r.squaredGLMM(max_temp0_lme4)

sjPlot::plot_model(
  max_temp0_lme4, type = "est", 
  show.values = T, vline.color = "gray90", colors = "viridis") +
  theme_bw()

```

## Time >100 ºC regressions: 50cm probe height
```{r time abv 100 regressions}

temps_abv100_50data <- temps_abv_100_data %>% 
  filter(probe_ht=="50cm")

abv100_lme1 <- lmerTest::lmer(seconds_abv_100 ~ drywt*veg_trt + fuel_moisture + avg_litter_depth_cm*veg_trt + veg_trt*water_trt + (1|Plot), data = temps_abv100_50data)
summary(abv100_lme1)

abv100_lm <- lm(seconds_abv_100 ~ drywt*veg_trt + avg_litter_depth_cm*veg_trt, data = temps_abv100_50data)
summary(abv100_lm)


abv100_lme2 <- lmerTest::lmer(seconds_abv_100 ~ drywt*veg_trt + fuel_moisture + water_trt + (1|Plot), data = temps_abv100_50data)
summary(abv100_lme2)

abv100_lme3 <- lmerTest::lmer(seconds_abv_100 ~ drywt*veg_trt + fuel_moisture + (1|Plot), data = temps_abv100_50data)
summary(abv100_lme3)

abv100_lme4 <- lmerTest::lmer(seconds_abv_100 ~ drywt*veg_trt + (1|Plot), data = temps_abv100_50data)
summary(abv100_lme4)

plot(abv100_lme4)

sjPlot::plot_model(abv100_lme4, type = "est", show.values = T, vline.color = "gray90", colors = "viridis") +
  theme_bw()
MuMIn::r.squaredGLMM(abv100_lme4)

```

# Tree Damage & Survival


## Percent dead limbs

```{r pct dead limbs boxplot}

ggplot(tree_dmg, aes(water_trt, pct_dead_limbs)) +
  # stat_summary(aes(fill = veg_trt), fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .5), size = 1, shape = 21) +
  geom_boxplot(aes(fill = veg_trt), alpha = 0, show.legend = FALSE) +
  geom_point(aes(color = veg_trt), position = position_jitterdodge(dodge.width = .8, jitter.width = .2), show.legend = TRUE) +
  invasion_color +
  invasion_fill +
  theme_bw() +
  def_theme +
  xlab("") +
  ylab("Dead limbs (%)") +
  theme(legend.position = "top")
# ggsave("figures/pct_dead_limbs.png", height = 4, width = 5, dpi = 300)

```

```{r pct dead limbs barchart, eval = FALSE}

ggplot(tree_dmg %>% 
         group_by(veg_trt, water_trt) %>% 
         summarise(avg_pct_dead_limbs = mean(pct_dead_limbs),
                   nobs = length(pct_dead_limbs),
                   se_dead_limbs = sd(pct_dead_limbs, na.rm = T)/sqrt(nobs)), 
       aes(water_trt, avg_pct_dead_limbs, fill = veg_trt)) +
  geom_col(position = dodge) + 
  geom_errorbar(aes(ymax = avg_pct_dead_limbs+se_dead_limbs, ymin = avg_pct_dead_limbs-se_dead_limbs), position = dodge, width = 0) +
  # stat_summary(fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .2)) +
  # invasion_color +
  invasion_fill +
  theme_bw() +
  def_theme +
  xlab("") +
  ylab("Dead limbs (%)") +
  theme(legend.position = "top")
# ggsave("figures/pct_dead_limbs_bar.png", height = 4, width = 5, dpi = 300)

```

```{r pct dead limbs data table summary}

knitr::kable(tree_dmg %>% 
         group_by(veg_trt, water_trt) %>% 
         summarise(avg_pct_dead_limbs = mean(pct_dead_limbs),
                   nobs = length(pct_dead_limbs),
                   se_dead_limbs = sd(pct_dead_limbs, na.rm = T)/sqrt(nobs))
         )

```

## Percent canopy brown

The same pattern as percent dead limbs.

```{r pct brown boxplot}

ggplot(tree_dmg, aes(water_trt, pct_brown)) +
  # stat_summary(aes(fill = veg_trt), fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .5), size = 1, shape = 21) +
  geom_boxplot(aes(fill = veg_trt), alpha = 0, show.legend = FALSE) +
  geom_point(aes(color = veg_trt), position = position_jitterdodge(dodge.width = .75, jitter.width = .3), show.legend = TRUE, alpha = 1) +
  invasion_color +
  invasion_fill +
  theme_bw() +
  def_theme +
  xlab("") +
  ylab("% Brown") +
  theme(legend.position = "top")
# ggsave("figures/pct_brown.png", height = 4, width = 5, dpi = 300)

```

```{r pct brown data table summary}

knitr::kable(tree_dmg %>% 
         group_by(veg_trt, water_trt) %>% 
         summarise(avg_pct_brown = mean(pct_brown),
                   nobs = length(pct_dead_limbs),
                   se_pct_brown = sd(pct_brown, na.rm = T)/sqrt(nobs)))

```

## Post-fire tree survival

Box-plots showing the proportion of trees in each plot that survived the fires.

```{r llp survival}

tree_surv_plot <- tree_dmg %>% 
  group_by(Plot, water_trt, veg_trt) %>% 
  summarise(survival = sum(survival)/length(survival))

ggplot(tree_surv_plot, aes(water_trt, survival*100)) +
  geom_boxplot(aes(fill = veg_trt), alpha = 0, show.legend = FALSE) +
  geom_point(aes(color = veg_trt), position = position_jitterdodge(dodge.width = .75, jitter.width = .3)) +
  # stat_summary(fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .5), size = 1) +
  invasion_fill +
  invasion_color +
  theme_bw() +
  def_theme +
  xlab("") +
  ylab("% survival") +
  theme(legend.position = "top")

```

```{r tree survival data table summary}

tree_dmg %>% 
  group_by(water_trt, veg_trt) %>% 
  summarise(plots = n_distinct(Plot),
            trees = length(tree_id),
            pct_survival = 100*sum(survival)/length(survival),
            sd_survival = 100*(sd(survival, na.rm = TRUE))) %>% 
  knitr::kable(.)

```

```{r tree mortality models}

# library(lme4)
# library(arm)# standardize() function centers & divide 2*sd
# library(piecewiseSEM)

## df of 19 trees in the ambientXinvasion treatment
# tree_dmg2 <- tree_dmg %>% 
  # filter(veg_trt != "reference", water_trt != "drought")

# tree_dmg2 <- anti_join(tree_dmg,tree_dmg2)

surv_glm1 <- glm(cbind(trees_alive,trees_dead) ~ avg_tree_ht_cm*veg_trt + avg_max_temp + avg_flameht_cm + veg_trt*water_trt, family = "binomial", data = filter(agg_plot_data, probe_ht=="50cm"))
summary(surv_glm1)
sjPlot::plot_model(surv_glm1, type = "pred", terms = c("avg_max_temp","veg_trt"))
# car::Anova(surv_glm1, type = "III", test = "LR")
## max temperature not significant
## s above 100 not significant
## heat flux not significant

surv_glm2 <- glm(cbind(trees_alive,trees_dead) ~ avg_tree_ht_cm + avg_heat_flux100 + veg_trt*water_trt, family = "binomial", data = filter(agg_plot_data, probe_ht=="25cm"))
summary(surv_glm2)
sjPlot::plot_model(surv_glm2, type = "pred", terms = c("avg_heat_flux100","veg_trt"))
## max temperature not significant
## s above 100 not significant
## heat flux not significant

surv_glm3 <- glm(cbind(trees_alive,trees_dead) ~ avg_tree_ht_cm + avg_heat_flux100 + veg_trt*water_trt, family = "binomial", data = filter(agg_plot_data, probe_ht=="0cm"))
summary(surv_glm3)
sjPlot::plot_model(surv_glm3, type = "pred", terms = c("avg_tree_ht_cm","veg_trt"))
sjPlot::plot_model(surv_glm3, type = "pred", terms = c("avg_heat_flux100","veg_trt"))
## max temperature not significant
## s above 100 not significant
## heat flux not significant


tree_dmg <- tree_dmg %>% 
  mutate(char_ht_scaled = scale(char_ht_cm, scale = 2*sd(char_ht_cm)),
         ht2_scaled = scale(ht2_cm, scale = 2*sd(ht2_cm)))

surv_glmer1 <- lme4::glmer(cbind(alive,dead) ~ char_ht_scaled + ht2_scaled + veg_trt + water_trt + (1|Plot), family = "binomial", data = tree_dmg)
# sjPlot::plot_model(surv_glmer1, type="diag")
sjPlot::plot_model(surv_glmer1)
summary(surv_glmer1)
car::Anova(surv_glmer1, type = "II")
```

```{r pairs plot}

tree_agg_plot_data %>% 
  ungroup(.) %>% 
  filter(probe_ht=="0cm") %>% 
  select(survival, avg_max_temp:avg_flameht_cm, char_ht_cm, ht2_cm, veg_trt, water_trt) %>% 
  GGally::ggpairs(., aes(color = veg_trt))

```

```{r tree-level mortality modeling}

surv_glmer0cm <- lme4::glmer(survival ~ ht2_cm + avg_heat_flux100 + (1|Plot), family = "binomial", data = filter(tree_agg_plot_data, probe_ht=="0cm"))
summary(surv_glmer0cm)
# car::Anova(surv_glmer0cm, type = "III")
dat25cm <- filter(tree_agg_plot_data, probe_ht=="25cm")
surv_glmer25cm <- lme4::glmer(survival ~ ht2_cm + avg_heat_flux100 + (1|Plot), family = "binomial", data = dat25cm)
summary(surv_glmer25cm)
# arm::standardize(surv_glmer25cm)

```

```{r modeling individual tree survival}

model_data <- tree_agg_plot_data %>% 
  ungroup(.) %>% 
  filter(probe_ht=="50cm") %>% 
  select(survival, avg_max_temp:avg_flameht_cm, char_ht_cm, ht2_cm, veg_trt, water_trt, Plot, tree_id) %>% 
  mutate(max_temp_scl = (avg_max_temp-mean(avg_max_temp))/(2*sd(avg_max_temp)),
         s_abv100_scl = (avg_s_abv100-mean(avg_s_abv100))/(2*sd(avg_s_abv100)),
         heat_flux_scl = (avg_heat_flux100-mean(avg_heat_flux100))/(2*sd(avg_heat_flux100)),
         ht_scl = (ht2_cm-mean(ht2_cm, na.rm=T))/(2*sd(ht2_cm, na.rm=T)),
         dry_wt_scl = (avg_dry_wt-mean(avg_dry_wt))/(2*sd(avg_dry_wt)),
         fuel_ht_scl = (avg_fuel_ht_cm-mean(avg_fuel_ht_cm))/(2*sd(avg_fuel_ht_cm)),
         tree_ht_scl =  (ht2_cm-mean(ht2_cm))/(2*sd(ht2_cm)),
         flame_ht_scl =  (avg_flameht_cm-mean(avg_flameht_cm))/(2*sd(avg_flameht_cm)),
         char_ht_scl = (char_ht_cm-mean(char_ht_cm))/(2*sd(char_ht_cm)),
         Plot = as.factor(Plot))

# summary(model_data)

surv_glmer50cm <- lme4::glmer(survival ~ ht2_cm*veg_trt + avg_heat_flux100 + avg_flameht_cm + (1|Plot), family = "binomial", data = model_data)
# summary(surv_glmer50cm)
surv_glmer50cm.std <- lme4::glmer(survival ~ tree_ht_scl*veg_trt + heat_flux_scl + flame_ht_scl + (1|Plot), family = "binomial", data = model_data)
# surv_glmer50cm.std <- standardize(surv_glmer50cm)
# summary(surv_glmer50cm.std)
sjPlot::plot_model(surv_glmer50cm.std, type = "pred", terms = c("tree_ht_scl"), pred.type = "fe")

flux50cm <- lmerTest::lmer(heat_flux_scl ~ dry_wt_scl + fuel_ht_scl + (1|Plot), data = model_data)
# summary(flux50cm)
# flux50cm.std <- standardize(flux50cm)
# summary(flux50cm.std)

fuel_load50cm <- lmerTest::lmer(dry_wt_scl ~ water_trt + veg_trt + (1|Plot), data = model_data)
# summary(fuel_load50cm)
# fuel_load50cm.std <- standardize(fuel_load50cm)

fuel_ht50cm <- lmerTest::lmer(fuel_ht_scl ~ water_trt + veg_trt + (1|Plot), data = model_data)
# summary(fuel_ht50cm)
# fuel_ht50cm.std <- standardize(fuel_ht50cm)

tree_ht50cm <- lmerTest::lmer(tree_ht_scl ~ water_trt + veg_trt + (1|Plot), data = model_data)
# summary(tree_ht50cm)
# tree_ht50cm.std <- standardize(tree_ht50cm)

# library(piecewiseSEM)
# psem.mod <- psem(
#   surv_glmer50cm,
#   flux50cm,
#   fuel_load50cm,
#   fuel_ht50cm,
#   tree_ht50cm
# )
# summary(psem.mod)

```



```{bash, eval=F}
## run manually 
cp  data-summary.html ~/Dropbox\ \(UF\)/UF\ Team\ Folder/Bivens-burn/
```

